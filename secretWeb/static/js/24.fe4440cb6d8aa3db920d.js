webpackJsonp([24],{hxO0:function(t,e){},lY8I:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("Dd8w"),n=a.n(s),i=a("NYxO"),o={data:function(){return{totalNewMsg:0,friendList:[],chatList:[],chatMode:{modeSelectShow:!1,modeIndex:0,modeList:[{name:"聊天模式"},{name:"托管模式"},{name:"训练模式"}]},menuShow:!0,chatNickName:"",chatUserImg:"",chatUserName:"",textareaMsg:""}},mounted:function(){var t=this;this.$nextTick(function(){document.addEventListener("click",t.closeModeMenu),t.checkNewMsg(),t.getNewMessageList(3),t.timer=setInterval(function(){t.checkNewMsg(),t.getNewMessageList(3)},5e3),t.textareaEven()})},destroyed:function(){clearInterval(this.timer),document.removeEventListener("click",this.closeModeMenu)},computed:n()({},Object(i.b)(["userInfo"])),methods:{chooseMode:function(t){var e=void 0;this.chatMode.modeSelectShow=!1,this.chatMode.modeIndex=t,e=0===t?2:1===t?1:3,this.changeChatMode(e)},closeModeMenu:function(t){this.$refs.discountBtn.contains(t.target)||(this.chatMode.modeSelectShow=!1)},textareaEven:function(){this.$refs.textareaFocus.addEventListener("keydown",function(t){13===t.keyCode&&t.preventDefault()})},scrollBottom:function(){var t=this;this.$nextTick(function(){t.$refs.chatContent.scrollTop=t.$refs.chatContent.scrollHeight})},sendChatMsg:function(){var t=this,e=new FormData;e.append("remarkNameQuery",this.chatNickName),this.$http.post(this.$api+"/danRobot/getMyWxFriendList",e).then(function(e){if(e.data.success)if(0===e.data.data.length){var a=new FormData;a.append("nickNameQuery",t.chatNickName),t.$http.post(t.$api+"/danRobot/getMyWxFriendList",a).then(function(e){e.data.success&&(t.chatUserName=e.data.data[0].userName,t.sendMsgFun())}).catch(function(t){console.log(t)})}else t.chatUserName=e.data.data[0].userName,t.sendMsgFun()}).catch(function(t){console.log(t)})},sendMsgFun:function(){var t=this,e=new FormData;e.append("toUserName",this.chatUserName),e.append("message",this.textareaMsg),this.$http.post(this.$api+"/danRobot/sendWechatMessage",e).then(function(e){e.data.success&&(t.scrollBottom(),t.getChatLog(t.chatNickName,t.chatUserImg),t.textareaMsg="")}).catch(function(t){console.log(t)})},getChatLog:function(t,e){var a=this;this.chatNickName=t,this.chatUserImg=e,this.menuShow=!1;var s=new FormData;s.append("lastID",0),s.append("friendName",""),s.append("messageType",0),s.append("startDate",""),s.append("endDate",""),s.append("page",1),s.append("pageSize",10),this.$http.post(this.$api+"/danRobot/getNewMessageList",s).then(function(e){if(e.data.success){var s=e.data.data.reverse();a.chatList=[],s.forEach(function(e){var s={msg:"",isRight:!1};JSON.parse(e.body).otherNickName===t&&(JSON.parse(e.body).fromUsername===a.userInfo.userName?(s.msg=JSON.parse(e.body).text,a.chatList.push(s)):(s.msg=JSON.parse(e.body).text,s.isRight=!0,a.chatList.push(s)))}),a.scrollBottom()}}).catch(function(t){console.log(t)})},getNewMessageList:function(t){var e=this,a=new FormData;a.append("lastID",0),a.append("friendName",""),a.append("messageType",t),a.append("startDate",""),a.append("endDate",""),a.append("page",1),a.append("pageSize",20),this.$http.post(this.$api+"/danRobot/getNewMessageList",a).then(function(t){if(t.data.success){e.totalNewMsg=t.data.mapData.totalRecord;var a={};e.friendList=[];for(var s=0;s<t.data.data.length;s++){var n=t.data.data[s];if(a[JSON.parse(n.body).otherNickName])for(var i=0;i<e.friendList.length;i++){var o=e.friendList[i];if(o.nickName===JSON.parse(n.body).otherNickName){o.msgData.push({msg:JSON.parse(n.body).text});break}}else e.friendList.push({nickName:JSON.parse(n.body).otherNickName,userImg:JSON.parse(n.body).otherHeadImgUrl,msgData:[{msg:JSON.parse(n.body).text}]}),a[JSON.parse(n.body).otherNickName]=n}}else"1001"===t.data.errorcode&&e.$router.push("/home/xiaodan")}).catch(function(t){console.log(t)})},checkNewMsg:function(){var t=this;this.$http.post(this.$api+"/danRobot/checkWxMsg").then(function(e){e.data.success||("1001"===e.data.errorcode?t.$router.push("/home/xiaodan"):"NOT_LOGGEDIN"===e.data.resultCode&&t.$router.push("/login"))}).catch(function(t){console.log(t)})},changeChatMode:function(t){var e=this,a=new FormData;a.append("wxUserName",this.chatUserName),a.append("intelligentFlag",t),this.$http.post(this.$api+"/danRobot/changeChatMode",a).then(function(t){t.data.success?console.log(t):"NOT_LOGGEDIN"===t.data.resultCode&&e.$router.push("/login")}).catch(function(t){console.log(t)})}}},c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"xiaodanChat"},[a("h3",{staticClass:"secret-title"},[t._v("小单托管")]),t._v(" "),a("div",{staticClass:"chatBox"},[a("div",{staticClass:"menu",class:{activeMenu:t.menuShow}},[a("div",{staticClass:"menu-mask",on:{click:function(e){t.menuShow=!1}}}),t._v(" "),a("div",{staticClass:"menuBox"},[a("div",{staticClass:"menu-head"},[a("img",{staticClass:"userImg",attrs:{src:t.userInfo.imgUrl,alt:""}}),t._v(" "),a("div",{staticClass:"menu-head-rt"},[a("p",[t._v(t._s(t.userInfo.userName))]),t._v(" "),a("router-link",{staticClass:"secret-a",attrs:{to:"/home/xiaodan"}},[t._v("退出账号")])],1)]),t._v(" "),a("div",{staticClass:"menulistBox"},[a("ul",{staticClass:"menu-list"},t._l(t.friendList,function(e,s){return a("li",{key:s,on:{click:function(a){return t.getChatLog(e.nickName,e.userImg)}}},[a("img",{attrs:{src:e.userImg,alt:""}}),t._v(" "),a("div",{staticClass:"li-rt"},[a("h4",[t._v(t._s(e.nickName))]),t._v(" "),a("div",{staticClass:"li-rt-bt"},[a("p",[t._v(t._s(e.msgData[0].msg))]),t._v(" "),a("span",[t._v(t._s(e.msgData.length))])])])])}),0)])])]),t._v(" "),a("div",{staticClass:"chatBox-head"},[a("div",{staticClass:"chatBox-head-lf"},[a("a",{staticClass:"chatBox-head-menu",on:{click:function(e){t.menuShow=!0}}}),t._v(" "),a("div",{staticClass:"userInfo"},[a("img",{staticClass:"userImg",attrs:{src:t.userInfo.imgUrl,alt:""}}),t._v(" "),a("div",{staticClass:"userInfo-rt"},[a("p",[t._v(t._s(t.userInfo.userName))]),t._v(" "),0!==t.totalNewMsg?a("a",[t._v(t._s(t.totalNewMsg)+"条新消息")]):t._e()])])]),t._v(" "),a("router-link",{staticClass:"chatBox-head-set",attrs:{tag:"div",to:"/home/xiaodan/xiaodanFriend"}})],1),t._v(" "),a("ul",{ref:"chatContent",staticClass:"chatBox-content",attrs:{id:"chatContent"}},t._l(t.chatList,function(e){return a("li",{key:e.id,class:{chatRightLi:!e.isRight}},[e.isRight?t._e():a("img",{attrs:{src:t.userInfo.imgUrl,alt:""}}),t._v(" "),e.isRight?a("img",{attrs:{src:t.chatUserImg,alt:""}}):t._e(),t._v(" "),a("div",[a("p",[t._v(t._s(e.msg))])])])}),0),t._v(" "),a("div",{staticClass:"inputHead"},[a("span",[t._v("当前模式：")]),t._v(" "),a("div",{staticClass:"inputTipBox inputTipBox-select"},[a("div",{staticClass:"inputTipDiv"},[a("a",{ref:"discountBtn",staticClass:"discount-btn",on:{click:function(e){t.chatMode.modeSelectShow=!t.chatMode.modeSelectShow}}},[t._v(t._s(t.chatMode.modeList[t.chatMode.modeIndex].name)),a("i",{staticClass:"arrowDown",class:{arrowActive:t.chatMode.modeSelectShow}})]),t._v(" "),a("ul",{staticClass:"selectMenu",class:{selectMenuActive:t.chatMode.modeSelectShow}},t._l(t.chatMode.modeList,function(e,s){return a("li",{key:e.name,class:{liActive:t.chatMode.modeIndex===s},on:{click:function(e){return t.chooseMode(s)}}},[t._v(t._s(e.name))])}),0)])])]),t._v(" "),a("div",{staticClass:"chatBox-input",on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.sendChatMsg()}}},[a("div",{staticClass:"chatBox-input-box"},[a("div",{staticClass:"textareaBox"},[a("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t.textareaMsg,expression:"textareaMsg",modifiers:{trim:!0}}],ref:"textareaFocus",attrs:{placeholder:t.$t("AI.aiExperience.text2")},domProps:{value:t.textareaMsg},on:{input:function(e){e.target.composing||(t.textareaMsg=e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})]),t._v(" "),a("div",{staticClass:"btn-box"},[a("button",{staticClass:"secret-btn",on:{click:function(e){return t.sendChatMsg()}}},[t._v(t._s(t.$t("popoup.text13")))])])])])])])},staticRenderFns:[]};var r=a("VU/8")(o,c,!1,function(t){a("hxO0")},"data-v-7845c514",null);e.default=r.exports}});